<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Online Teacher Booking</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body {
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg, red, orange, yellow, green, cyan, blue, violet);
}
.card { border-radius: 20px; }
.btn-rainbow {
  background: linear-gradient(90deg, red, orange, yellow, green, cyan, blue, violet);
  color: #fff;
  border: none;
  border-radius: 50px;
  font-weight: bold;
}
.links-container a {
  display: inline-block;
  margin: 5px;
}
</style>
</head>
<body>

<div class="container py-5">
  <div class="card p-4">
    <h3 class="mb-3">üìÖ Book a Class</h3>

    <form id="bookingForm">
      <input type="text" name="name" placeholder="Student / Parent Name" class="form-control mb-3" required>
      <input type="email" name="email" placeholder="Email" class="form-control mb-3" required>
      <input type="date" name="date" id="dateField" class="form-control mb-3" required>

      <select id="teacherSelect" name="teacher" class="form-select mb-3" required>
        <option value="">üë©‚Äçüè´ Select Teacher</option>
        <option value="Teacher Anna">Teacher Anna</option>
        <option value="Teacher John">Teacher John</option>
        <option value="Teacher Maria">Teacher Maria</option>
      </select>

      <select id="timeSelect" name="time" class="form-select mb-3" required>
        <option value="">Select Time</option>
      </select>

      <input class="form-control mb-3" name="phone" placeholder="WhatsApp Number (e.g. 97455512345)" required>

      <button class="btn btn-rainbow w-100 py-2">‚ú® Book Now</button>
    </form>

    <div id="links" class="mt-3 links-container"></div>
  </div>
</div>

<script>
const scriptURL = "YOUR_DEPLOYED_APPS_SCRIPT_URL"; // replace with your Apps Script web app URL

const form = document.getElementById("bookingForm");
const dateField = document.getElementById("dateField");
const teacherSelect = document.getElementById("teacherSelect");
const timeSelect = document.getElementById("timeSelect");
const linksDiv = document.getElementById("links");

// Disable past dates
dateField.min = new Date().toISOString().split("T")[0];

// Load available slots dynamically
function loadTimes() {
  const date = dateField.value;
  const teacher = teacherSelect.value;
  if (!date || !teacher) return;
  fetch(`${scriptURL}?action=slots&date=${date}&teacher=${teacher}`)
    .then(res => res.json())
    .then(times => {
      timeSelect.innerHTML = '<option value="">Select Time</option>';
      times.forEach(t => {
        const opt = document.createElement('option');
        opt.value = t;
        opt.textContent = t;
        timeSelect.appendChild(opt);
      });
    })
    .catch(err => console.error("Error loading times:", err));
}

dateField.addEventListener("change", loadTimes);
teacherSelect.addEventListener("change", loadTimes);

// Submit form
form.addEventListener("submit", e => {
  e.preventDefault();
  linksDiv.innerHTML = ""; // clear previous links
  fetch(scriptURL, { method: "POST", body: new FormData(form) })
    .then(res => res.text())
    .then(msg => {
      alert(msg);

      if (!msg.includes("Booking failed")) {
        // Prepare WhatsApp & WeChat links
        const name = form.name.value;
        const teacher = form.teacher.value;
        const date = form.date.value;
        const time = form.time.value;
        const phone = form.phone.value;

        const waLink = `https://wa.me/${phone}?text=${encodeURIComponent(
          "Hello " + name + "! Your class with " + teacher + " is confirmed on " + date + " at " + time
        )}`;

        const wechatQR = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(
          "WeChat ID: teacher_wechat_id\nMessage: Hello " + name + "! Your class with " + teacher + " is confirmed on " + date + " at " + time
        )}`;

        linksDiv.innerHTML = `
          <p>‚úÖ Booking confirmed! Send message:</p>
          <a href="${waLink}" target="_blank" class="btn btn-success mb-2">WhatsApp</a>
          <a href="${wechatQR}" target="_blank" class="btn btn-info mb-2">WeChat QR</a>
        `;
      }

      form.reset();
      timeSelect.innerHTML = '<option value="">Select Time</option>';
    })
    .catch(err => {
      console.error(err);
      alert("‚ùå Booking failed");
    });
});
</script>

</body>
</html>
